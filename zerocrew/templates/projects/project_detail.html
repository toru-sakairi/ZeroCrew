{% extends 'base.html' %}

{% block title %}{{ project.title }} - ZeroCrew{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h1 class="h3 mb-0">{{ project.title }}</h1>
        <div>
            {% if request.user == project.user %}
            <a href="{% url 'projects:project_chat' project.pk %}" class="btn btn-success me-2">グループチャット</a>
            <a href="{% url 'projects:applicant_list' project.pk %}" class="btn btn-info">応募者を管理</a>
            {% else %}
            {% if is_member %}
            <a href="{% url 'projects:project_chat' project.pk %}" class="btn btn-success">グループチャットに参加</a>
            {% elif is_applied %}
            <a href="#" class="btn btn-info disabled">承認待ち</a>
            {% else %}
            <form action="{% url 'projects:apply_for_project' project.pk %}" method="post" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">このプロジェクトに応募する</button>
            </form>
            {% endif %}
            {% endif %}
        </div>
    </div>
    <div class="card-body">

        <div class="d-flex align-items-center mb-3">
            <form action="{% url 'projects:toggle_like' project.pk %}" method="post" class="me-3">
                {% csrf_token %}
                {% if is_liked %}
                    {# いいね済みの場合は、塗りつぶされたハートと「いいね解除」ボタン #}
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-heart-fill"></i> いいね解除
                    </button>
                {% else %}
                    {# まだの場合は、枠線のハートと「いいね」ボタン #}
                    <button type="submit" class="btn btn-outline-danger">
                        <i class="bi bi-heart"></i> いいね
                    </button>
                {% endif %}
            </form>
            <span class="text-danger fw-bold">
                <i class="bi bi-heart-fill"></i> {{ like_count }}
            </span>
        </div>

        <!-- プロジェクト詳細情報をここに記述 -->
        <p class="text-muted">
            投稿者: <a href="{% url 'users:profile' project.user.pk %}">{{ project.user.username }}</a> <br>
            最終更新日: {{ project.updated_at|date:"Y年m月d日 H:i" }}
        </p>
        <hr>
        <h5 class="card-title">プロジェクト概要</h5>
        <p class="card-text" style="white-space: pre-wrap;">{{ project.outline }}</p>
        <!-- 背景 -->
        <hr>
        <h5 class="card-title">背景・課題</h5>
        <p class="card-text" style="white-space: pre-wrap;">{{ project.background }}</p>
        <!-- ゴール -->
        <hr>
        <h5 class="card-title">目標・ゴール</h5>
        <p class="card-text" style="white-space: pre-wrap;">{{ project.goal }}</p>
        <hr>
        <!-- タグ機能の追加 -->
        {% if project.tags.all %}
        <hr>
        <div>
            <strong>タグ：</strong>
            {% for tag in project.tags.all %}
            <a href="{% url 'projects:project_list_by_tag' tag.slug %}" class="tag">
                {{ tag.name }}
            </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    <div class="card-footer">
        <a href="{% url 'projects:home' %}" class="btn btn-secondary">&laquo; プロジェクト一覧に戻る</a>
    </div>
</div>
{% endblock %}